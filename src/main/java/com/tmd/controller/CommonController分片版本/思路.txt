这个分片上传本质上到底和我们普通的直传有什么区别呢


分片上传逻辑

我是这么想的，首先前端上传唯一的请求ID，同时还有这个文件的MD5值（后续拿全之后开始校验），然后后端拿到之后生成一个唯一的任务ID，并且以这个ID为键，值为一个哈希map，这个哈希map键为分块的编号
值为暂存的地址，然后把这个任务ID返回给前端。后续每次上传都要携带上，MD5值以String类型来进行存储

然后开始分片上传，每次上传肯定要携带上任务ID，分片的各种信息，每上传一次都回复一个收到，否则重传

最后发送结束标记，后端返回收到，合并文件，校验并上传云端，清空暂存区，删除键即可

给后端的「分片任务」加过期机制
你的思路里是「合并后删键清暂存」，但如果用户「传了部分分块就放弃上传」，后端的「任务 ID + 暂存分块」会一直占着磁盘。解决：给每个任务 ID 加「过期时间」（比如 24 小时），后端定时扫描「超时未完成的任务」，自动删除任务记录 + 暂存分块，释放磁盘。落地思路：可以在 Redis 里存任务信息时设置过期时间，或者用数据库存任务表，加「更新时间」字段，定时清理。



暂存区记得放在一个固定的独立的临时目录里面

合并采用流合并，防止后端内存溢出