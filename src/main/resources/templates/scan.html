<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>扫码确认登录</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="p-3">
<h3>扫码确认登录</h3>

<div id="qrCodeId" class="mb-3"></div>

<div class="mb-3">
    <label for="userSelect" class="form-label">选择用户</label>
    <select id="userSelect" class="form-select"></select>
</div>

<button id="confirmBtn" class="btn btn-success me-2">确认登录</button>
<button id="cancelBtn" class="btn btn-danger">取消登录</button>

<div id="msg" class="mt-3"></div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const qrCodeId = urlParams.get('qrCodeId');

    document.getElementById('qrCodeId').innerText = "二维码ID：" + qrCodeId;

    // 模拟请求获取所有用户
    const users = {
        "user1": "Alice",
        "user2": "Bob"
    };

    for (const [id, name] of Object.entries(users)) {
        const option = document.createElement('option');
        option.value = id;
        option.textContent = name;
        userSelect.appendChild(option);
    }

    document.getElementById('confirmBtn').onclick = () => {
        const userId = userSelect.value;
        axios.post('/api/qrcode/confirm', {qrCodeId, userId})
            .then(res => {
                msgDiv.innerHTML = `<div class="alert alert-success">${res.data}</div>`;
            })
            .catch(err => {
                msgDiv.innerHTML = `<div class="alert alert-danger">确认失败：${err.response?.data || err.message}</div>`;
            });
    };

    document.getElementById('cancelBtn').onclick = () => {
        axios.post('/api/qrcode/cancel', {qrCodeId})
            .then(res => {
                msgDiv.innerHTML = `<div class="alert alert-warning">${res.data}</div>`;
            })
            .catch(err => {
                msgDiv.innerHTML = `<div class="alert alert-danger">取消失败：${err.response?.data || err.message}</div>`;
            });
    };
</script>
</body>
</html>
